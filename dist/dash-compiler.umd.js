(function(s,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("mc-project-core"),require("path-browserify")):typeof define=="function"&&define.amd?define(["exports","mc-project-core","path-browserify"],o):(s=typeof globalThis!="undefined"?globalThis:s||self,o(s.DashCompiler={},s.mcProjectCore,s.pathBrowserify))})(this,function(s,o,l){"use strict";class a extends o.ProjectConfig{constructor(t,i){super(l.dirname(i));this.fileSystem=t,this.configPath=i}readConfig(){return this.fileSystem.readJson(this.configPath)}writeConfig(t){return this.fileSystem.writeJson(this.configPath,t)}}class c{constructor(){this.plugins=[]}async runBuildStartHooks(){for(const t of this.plugins)await t.runBuildStartHook()}async runIncludeHooks(){let t=[];for(const i of this.plugins){const e=await i.runIncludeHook();Array.isArray(e)&&t.push(...e)}return t}async runTransformPathHooks(t){let i=t;for(const e of this.plugins){const n=e.runTransformPathHook(i);if(n===null)return null;n!==void 0&&(i=n)}}async runBuildEndHooks(){for(const t of this.plugins)await t.runBuildEndHook()}}class u{constructor(t){this.dash=t,this.files=[]}all(){return this.files}filtered(t){return this.files.filter(t)}async loadAll(){const t=new Set,i=this.dash.projectConfig.getAvailablePackPaths();for(const n of i){const d=await this.dash.fileSystem.allFiles(n);for(const p of d)t.add(l.join(n,p))}const e=await this.dash.plugins.runIncludeHooks();for(const n of e)t.add(n);this.files=Array.from(t)}}class h{constructor(t,i){this.fileSystem=t,this.options=i,this.plugins=new c,this.includedFiles=new u(this),this.projectRoot=l.dirname(i.config),this.projectConfig=new a(t,i.config)}async build(){await this.plugins.runBuildStartHooks(),await this.includedFiles.loadAll(),await this.plugins.runBuildEndHooks()}watch(){}}class f{async writeJson(t,i,e=!0){await this.writeFile(t,JSON.stringify(i,null,e?"	":0))}async readJson(t){return JSON.parse(await this.readFile(t).then(i=>i.text()))}watchDirectory(t,i){console.warn("Watching a directory for changes is not supported on this platform!")}}s.Dash=h,s.FileSystem=f,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
